---
title: "Modal esc ê´€ë ¨ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…"
date: 2022-06-25
---

# ìš”êµ¬ì‚¬í•­

- ëª¨ë‹¬ì´ 2ê°œ ì´ìƒ ë„ì›Œì ¸ìˆì„ ë•Œ ê°€ì¥ ìœ„ì˜ ê²ƒë¶€í„° closeë˜ê²Œ í•´ì£¼ì„¸ìš”.

# ê¸°ì¡´ ëª¨ë‹¬ì˜ êµ¬ì¡°

- bodyì— ì ìš©ëœ handleKeydown ì´ë²¤íŠ¸ ì•ˆì—ì„œ `e.key`ê°€ escape keyì¼ê²½ìš°ì— onCloseë¥¼ í•´ì£¼ì—ˆë‹¤. ë•Œë¬¸ì—, ëª¨ë‹¬ì´ 2ê°œ ì´ìƒ ë„ì›Œì ¸ë„ escë¥¼ ëˆ„ë¥´ë©´ í•œêº¼ë²ˆì— closeë˜ê³  ìˆì—ˆë‹¤.

```ts
export const Modal = function Modal({
  open,
  onClose,
  isInterrupt,
  children,
}: ModalProps) {

    ...

  useEffect(() => {
    if (!open) {
      return
    }

    const ESCAPE_KEY = 'Escape'

    const handleKeydown = (e: KeyboardEvent): void => {
      if (onClose && e.key === ESCAPE_KEY) {
        onClose()
      }
    }

    ...

  }, [open])

    ...

  return (
    <Modal open={open}>
      <ModalRoot role="presentation">
        <ModalDim
          .....
        />
        {children}
      </ModalRoot>
    </Modal>
  )
}
```

# 1ì°¨ ë¦¬íŒ©í† ë§

- ModalRootì— refë¥¼ ì§€ì •í•´ì¤˜ì„œ, ref.currentì™€ modalsì˜ ë§ˆì§€ë§‰ ìš”ì†Œê°€ ê°™ì§€ ì•Šìœ¼ë©´ returní•´ì£¼ì—ˆë‹¤.

```ts
const modalRef = useRef<HTMLDivElement>(null)

useEffect(() => {
  if (!open) {
    return
  }
  const ESCAPE_KEY = 'Escape'

  const handleKeydown = (e: KeyboardEvent): void => {
    if (onClose && e.key === ESCAPE_KEY) {
      const modals = document.querySelectorAll(`[role=${MODAL_ROLE}]`)

      if (modals[modals.length-1] !== modalRef.current) {
        return
      }

      onClose()
    }
  }

  ...

}, [open])

...


return (
  <Modal open={open}>
    <ModalRoot role={MODAL_ROLE} ref={modalRef}>
      <ModalDim
          ...
      />
      {children}
    </ModalRoot>
  </Modal>
)
```

# 2ì°¨ ë¦¬íŒ©í† ë§

- escape keyë¥¼ ì§€ì •í•´ì£¼ëŠ”ê±´ ë„ˆë¬´ ë©”ë‰´ì–¼í•˜ë‹¤. ë§Œì•½ì— ì•±ë„ ì œê³µí•œë‹¤ê³  ê°€ì •í•œë‹¤ë©´ escëŠ” ì‘ë™ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.

### HTMLDialogElement.showModal()

https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/showModal

> showModal()ë©”ì„œë“œëŠ” ë‹¤ë¥¸ ëŒ€í™” ìƒì ìœ„ì— ëŒ€í™” ìƒìë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. `::backdrop` ìš”ì†Œ ì™€ í•¨ê»˜ ìµœìƒìœ„ ë ˆì´ì–´ì— í‘œì‹œë©ë‹ˆë‹¤.
> ëŒ€í™” ìƒì ì™¸ë¶€ì˜ ìƒí˜¸ ì‘ìš©ì´ ì°¨ë‹¨ë˜ê³  ëŒ€í™” ìƒì ì™¸ë¶€ì˜ ì½˜í…ì¸ ê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.

- ì•„ì§ ì‹¤í—˜ì  ê¸°ìˆ ì´ë¼ëŠ” HTMLDialogElementì˜ `showModal()`. í•´ë‹¹ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ esc keyë¥¼ ë§¤ë‰´ì–¼í•˜ê²Œ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ì´ë¯¸ escë¥¼ í†µí•´ closeí•˜ëŠ” ê¸°ëŠ¥ì´ ì ìš©ë˜ì–´ìˆë‹¤.

- modalì„ `dialog`íƒœê·¸ë¡œ ë³€ê²½í•˜ê³  showModal ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë¦¬íŒ©í† ë§í–ˆë‹¤.

```ts
const modalRef = useRef<HTMLDialogElement>(null)

useEffect(() => {
  if (open) {
    modalRef.current?.showModal()
  }
}, [open])

....

return (
  <Modal open={open}>
    <ModalRoot
      role={MODAL_ROLE}
      ref={modalRef}
      onClose={(e) => {
        e.preventDefault()
        const modals = document.querySelectorAll(`[role=${MODAL_ROLE}]`)
        if (modals[modals.length-1] !== modalRef.current) {
          return
        }
        onClose?.()
      }}
    >
      <ModalDim
        ...
      />
      {children}
    </ModalRoot>
  </Modal>
)
```

# ë¬¸ì œìƒí™©

- ìœ„ì™€ ê°™ì´ 2ì°¨ ë¦¬íŒ©í† ë§ê¹Œì§€ ë§ˆì³¤ì„ë•Œ modalì€ ê¸°ëŠ¥ìƒìœ¼ë¡œ ì „í˜€ ë¬¸ì œê°€ ì—†ì—ˆë‹¤. í•˜ì§€ë§Œ, jestì—ì„œ í…ŒìŠ¤íŠ¸ê°€ ê¹¨ì¡Œë‹¤.  
  jestì—ì„œ showModal() ë©”ì„œë“œë¥¼ ì•„ì˜ˆ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

![](https://velog.velcdn.com/images/nsunny0908/post/36d9abd1-7383-4b9d-a9d9-f73fbd07b8f7/image.png)

í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ê³  êµ¬ê¸€ë§ì„ í•˜ë‹¤ê°€, ë‚˜ì™€ ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ ê²ªì€ ì‚¬ëŒì„ ë°œê²¬í–ˆë‹¤.

[TypeError: scrollIntoView is not a function](https://stackoverflow.com/questions/53271193/typeerror-scrollintoview-is-not-a-function/53294906#53294906)

jestë‚´ì—ì„œ ì„ì˜ë¡œ í•¨ìˆ˜ë¥¼ ëª¨í‚¹í•´ì„œ í•´ê²°í–ˆë‹¤ëŠ” ë‚´ìš©ì´ì˜€ë‹¤.

![](https://velog.velcdn.com/images/nsunny0908/post/0c570420-98bc-454a-ada6-40189009afe1/image.png)

ê·¸ë˜ì„œ ëª¨í‚¹í•´ì¤¬ë”ë‹ˆ,

```ts
window.HTMLDialogElement.prototype.showModal = jest.fn()
```

![](https://velog.velcdn.com/images/nsunny0908/post/03504b84-7bb5-4c2b-85ba-ade58f754009/image.png)

íƒ€ì…ì—ëŸ¬ê°€ ë–´ë‹¤.

# ì‚½ì§ˆ ê²°ê³¼ ğŸª“

- jestëŠ” jsdomì—ì„œ ëŒì•„ê°„ë‹¤. (jsdomì´ ë¸Œë¼ìš°ì € í™˜ê²½ì¸ ê²ƒì²˜ëŸ¼ ì‹œë®¬ë ˆì´ì…˜í•´ì£¼ëŠ” ì—­í• )  
  jsdom ì—ì„œ htmldialogElementê°€ ì„œí¬íŠ¸ê°€ ì•ˆë˜ëŠ” ê²Œ ë¬¸ì œì˜ ì›ì¸ì´ì˜€ë‹¤.. ğŸ˜‡ (í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ê³  ëœ¬ ì´ìœ )

  https://stackoverflow.com/questions/53271193/typeerror-scrollintoview-is-not-a-function/53294906#53294906

  ê²Œë‹¤ê°€ typescriptì—ì„œë„ ì•„ì§ê¹Œì§€ dialog íƒœê·¸ì— ëŒ€í•œ ì¶©ë¶„í•œ ì§€ì›ì´ ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤. (íƒ€ì… ì—ëŸ¬ê°€ ëœ¬ ì´ìœ )

  https://github.com/Microsoft/TypeScript/issues/16880

# ëŠë‚€ ì 

- ì‹¤í—˜ì  ê¸°ìˆ ì€ ìƒê°ë³´ë‹¤ ì§€ì›ì´ ë˜ì§€ ì•ŠëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ë§ë‹¤ëŠ” ê±¸ ëŠê¼ˆë‹¤..ğŸ˜¹

  ![](https://velog.velcdn.com/images/nsunny0908/post/bfa3bcd0-0779-4679-8e3b-70e083efbc4c/image.png)
